@using Microsoft.AspNetCore.Identity
@model Services.Data.RecipeData

@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager

@{
	ViewBag.Title = Model.Title;
	Layout = "~/Views/Shared/_Layout.cshtml";
}
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-pUA-Compatible" content="ie=edge" />
	<title>Star Rating in HTML CSS & JavaScript</title>
	<link rel="stylesheet" href="style.css" />
	<!-- Fontawesome CDN Link -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
	<script src="script.js" defer></script>
</head>
<script>
	function scrollToSection(sectionId) {
		var targetElement = document.querySelector(sectionId);
		var targetPosition = targetElement.offsetTop;

		window.scrollTo({
			top: targetPosition,
			behavior: "smooth"
		});
	}

	function sendEmailAndIncreaseShare() {
		var encodedTitle = encodeURIComponent("Recipe: " + "@Model.Title");
		var encodedDescription = encodeURIComponent("@Model.Description");
		var encodedIngredients = encodeURIComponent("@Model.Ingredients");
		var encodedDirections = encodeURIComponent("@Model.Directions");
		var recipeId = "@Model.RecipeId";

		var mailtoLink = "mailto:?subject=" + encodedTitle + "&body=" + encodedDescription + "%0D%0A%0D%0AIngredients:%0D%0A" + encodedIngredients + "%0D%0A%0D%0ADirections:%0D%0A" + encodedDirections + "%0D%0AView%20more%20at%20https://localhost:7186/Recipe/RecipeDetail/?id=" + recipeId;
		window.location.href = mailtoLink;

		var xhr = new XMLHttpRequest();
		xhr.open("GET", "/Recipe/IncreaseNumberShare?recipeId=" + recipeId, true);
		xhr.send();
	}

</script>

<body>
	<div id="page-title" class="padding-top-30px padding-bottom-10px gradient-white">
		<div class="container text-left">
			<ol class="breadcrumb opacity-5">
				<li><a href="@Url.Action("Index", "Home")">Home</a></li>
				<li class="active">Recipe</li>
			</ol>
		</div>
	</div>

	<div class="container">
		<div class="row">
			<div class="col-lg-8">
				<h1 class="font-weight-500 margin-bottom-20px">@Model.Title</h1>
				<div class="row">
					<div class="rating col-3">
						<ul>
							<li class="active"></li>
							<li class="active"></li>
							<li class="active"></li>
							<li class="active"></li>
							<li></li>
							<a href="#" onclick="scrollToSection('#addFeedback')">@Model.AvgRate (99)</a>
						</ul>
					</div>
					|
					<div class="col-5">
						<a href="#" onclick="sendEmailAndIncreaseShare()">@Model.NumberShare share(s)</a>
						<span class="margin-lr-5px">|</span>
						<a href="#">55 photos</a>
					</div>
				</div>

				<div class="margin-tb-10px">
					@Model.Description
				</div>
				<div class="margin-bottom-10px">
					Recipe by Cook 
					<span class="margin-lr-5px">|</span>
					Updated on @Model.Date
				</div>
				<div class="margin-bottom-20px">
					<form method="get" action="/Recipe/ToggleCollection?recipeId=@Model.RecipeId">
						<input type="hidden" name="recipeId" value="@Model.RecipeId" />
						@if (SignInManager.IsSignedIn(User) && Model.Collection)
						{
							<button type="submit" class="text-red border-0 bg-transparent" id="saveButton">
								<i class="icon_heart"></i> Unsave
							</button>
						}
						else
						{
							<button type="submit" class="text-red border-0 bg-transparent" id="saveButton">
								<i class="far fa-heart"></i> Save
							</button>
						}

						<span class="margin-left-5px margin-right-5px">|</span>
						<a href="#" onclick="scrollToSection('#addFeedback')"><i class="far fa-star"></i> Rate</a>
						<span class="margin-left-5px margin-right-5px">|</span>
						<a href="@Url.Action("PrintRecipe", "Recipe", new { recipeId = Model.RecipeId })" target="_blank"><i class="fas fa-print"></i> Print</a>
						<span class="margin-left-5px margin-right-5px">|</span>

						<a href="#" onclick="sendEmailAndIncreaseShare()">
							<i class="fas fa-share"></i> Share via Email
						</a>

						@*@{
							var encodedTitle = Uri.EscapeDataString("Recipe: " + @Model.Title);
							var encodedDescription = Uri.EscapeDataString(@Model.Description);
							var encodedIngredients = string.Join(Environment.NewLine, Model.Ingredients.Select(i => "- " + Uri.EscapeDataString(i.IngredientName)));
							var encodedDirections = string.Join(Environment.NewLine, Model.Directions.Select(i => "- " + Uri.EscapeDataString(i.Direction1)));
							//var encodedUrl = Uri.EscapeDataString($"https://localhost:7186/Recipe/RecipeDetail/?id={Model.RecipeId}");
						}
						<a 
						   href="mailto:?subject=@encodedTitle&amp;body=@Html.Raw(encodedDescription)%0D%0A%0D%0AIngredients:%0D%0A@{
					    foreach (var item in Model.Ingredients) {
												@Html.Raw(Uri.EscapeDataString("- " + item.IngredientName + Environment.NewLine))
}
 }%0D%0A%0D%0ADirections:%0D%0A%0D%0A@{
					    foreach (var item in Model.Directions) {
												@Html.Raw(Uri.EscapeDataString("Step " + @item.Step + ": " + item.Direction1 + Environment.NewLine + Environment.NewLine))
}
 }%0D%0AView%20more%20at%20https://localhost:7186/Recipe/RecipeDetail/?id=@Model.RecipeId">
							<i class="fas fa-share"></i> Share via Email
						</a>*@
						
					</form>
				</div>

				<div class="margin-bottom-40px card border-0 box-shadow">
					<div class="card-img-top"><a href="#"><img src="@Model.Img" alt=""></a></div>
					<div class="padding-lr-30px padding-tb-20px">
						<div class="padding-tb-10px">
							<h3>Ingredients</h3>
							<ul>
								@foreach (var item in Model.Ingredients)
								{
									<li>@item.IngredientName</li>
								}
							</ul>
						</div>
						<div class="padding-tb-10px">
							<h3>Directions</h3>
							<div class="padding-lr-20px">
								@foreach (var item in Model.Directions)
								{
									<p><b>Step @item.Step</b> - <span>@item.Direction1</span></p>
								}
							</div>
						</div>
						<div class="padding-tb-10px">
							<h3>Tags</h3>
							<div class="padding-lr-20px">
								<p>
									@foreach (var item in Model.Tags)
									{
										@if (item.ToString().Trim() != null)
										{
											<a href="#">#@item.TagName</a>
											@*@if (item != Model.Tags.Last())
											{
												<text>,</text>
											}*@
										}
									}
								</p>
							</div>
						</div>
						<div class="row no-gutters padding-tb-20px">
							<div class="col-12 text-center">
								<button id="scrollButton" onclick="scrollToSection('#addFeedback')"
										class="btn box-shadow padding-lr-30px padding-tb-10px btn-sm border-2 border-radius-10 btn-inline-block background-main-color text-white margin-right-20px margin-tb-12px ">
									I MADE IT <i class="fas fa-utensil-spoon"></i>
								</button>
								@*<button class="btn box-shadow padding-lr-30px padding-tb-10px btn-sm border-2 border-radius-10 btn-inline-block border-main-color text-main-color margin-right-20px margin-tb-12px ">
									PRINT <i class="fas fa-print"></i>
								</button>*@
								<a class="btn box-shadow padding-lr-30px padding-tb-10px btn-sm border-2 border-radius-10 btn-inline-block border-main-color text-main-color margin-right-20px margin-tb-12px"
								   href="@Url.Action("PrintRecipe", "Recipe", new { recipeId = Model.RecipeId })" >PRINT <i class="fas fa-print"></i></a>

							</div>
						</div>

					</div>
				</div>


				<div class="margin-bottom-40px box-shadow">
					<div class="padding-30px background-white">
						<h3><i class="far fa-star margin-right-10px text-main-color"></i> Add Review </h3>
						<hr>
						<form id="addFeedback" method="post" action="Feedback/AddFeedback1">
							@*<div class="form-row">
								<div class="form-group col-md-6">
									<label for="inputName">Full Name</label>
									<input type="text" class="form-control" id="inputName" placeholder="Name">
								</div>
								<div class="form-group col-md-6">
									<label for="inputEmail4">Email</label>
									<input type="email" class="form-control" id="inputEmail4" placeholder="Email">
								</div>
							</div>*@
							<input type="hidden" name="user" value="@User.Identity.Name"/>
							<div class="rating-box" >
								<div class="stars">
									<input hidden type="radio" name="rating" value="1" id="rating-1">
									<label for="rating-1"><i class="fa-solid fa-star"></i></label>
									<input hidden type="radio" name="rating" value="2" id="rating-2">
									<label for="rating-2"><i class="fa-solid fa-star"></i></label>
									<input hidden type="radio" name="rating" value="3" id="rating-3">
									<label for="rating-3"><i class="fa-solid fa-star"></i></label>
									<input hidden type="radio" name="rating" value="4" id="rating-4">
									<label for="rating-4"><i class="fa-solid fa-star"></i></label>
									<input hidden type="radio" name="rating" value="5" id="rating-5">
									<label for="rating-5"><i class="fa-solid fa-star"></i></label>
								</div>

							</div>
						@*	<div class="form-row">
								<div class="rating">
									<ul>
										<li data-value="1">&#9733;</li>
										<li data-value="2">&#9733;</li>
										<li data-value="3">&#9733;</li>
										<li data-value="4">&#9733;</li>
										<li data-value="5">&#9733;</li>
									</ul>
									<p id="rating-value">0 sao</p>
								</div>
							</div>*@

							<div class="form-group">
								<label for="exampleFormControlTextarea1">Feedback</label>
								<textarea class="form-control" id="exampleFormControlTextarea1" rows="3"
										  placeholder="Feedback"></textarea>
							</div>
							<button type="submit"
							   class="btn-sm btn-lg btn-block background-main-color text-white text-center font-weight-bold text-uppercase border-radius-10 padding-10px">
								Add Now!
							</button>
						</form>
					</div>
				</div>


				<div class="margin-bottom-80px box-shadow">
					<div class="padding-30px background-white">
						<h3><i class="far fa-star margin-right-10px text-main-color"></i> Review &amp; Rating</h3>
						<hr>

						<ul class="commentlist padding-0px margin-0px list-unstyled text-grey-3">
							@await Component.InvokeAsync("LoadFeedback", new { recipeID = Model.RecipeId });
							
						</ul>
					</div>
				</div>

			</div>

			<div class="col-lg-4">
				<div class="listing-search box-shadow background-main-color padding-30px margin-bottom-30px">
					<form action="../../Search/SearchKeyWord" class="row no-gutters">
						<div class="col-md-12 margin-bottom-20px">
							<div class="keywords">
								<input class="listing-form first max-width-set" type="text" placeholder="Keywords...." name="keyword" id="postTitle" value="">
							</div>
						</div>
						<div class="col-md-12 margin-tb-10px">
							<button type="submit" class="listing-bottom border-radius-10 background-second-color box-shadow">Search Now</button>
						</div>
					</form>
				</div>

				@*<div class="margin-tb-40px text-center">
					<h1 class="font-weight-500 margin-bottom-20px">Related Recipes</h1>
					<hr />

					<div class="col-lg-3 col-md-3 text-center margin-bottom-40px">
						<div class="hvr-float">
							<div class="thum"><a href="#"><img class="border-radius-8 box-shadow" src="http://placehold.it/270x270" alt=""></a></div>
							<a class="h4 d-block margin-top-20px" href="#">M.Salman ali</a>
							<small class="text-grey-2">(145 Recipes)</small>
						</div>
					</div>


				</div>*@
			</div>
		</div>
	</div>
	<script>
		const rating = document.querySelector('.rating');
		const stars = rating.querySelectorAll('li');
		const ratingValue = rating.querySelector('#rating-value');

		stars.forEach((star) => {
			star.addEventListener('click', () => {
				ratingValue.textContent = `${star.getAttribute('data-value')} sao`;
				stars.forEach((s, index) => {
					if (index < star.getAttribute('data-value')) {
						s.classList.add('active');
					} else {
						s.classList.remove('active');
					}
				});
			});
		});
	</script>

	<style>
	
	    /* Import Google font - Poppins */

.rating-box {
  position: relative;
  background: #fff;
  padding: 25px 50px 35px;
  border-radius: 25px;
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: "Poppins", sans-serif;
}
.rating-box header {
  font-size: 22px;
  color: #dadada;
  font-weight: 500;
  margin-bottom: 20px;
  text-align: center;
}
.rating-box .stars {
  display: flex;
  align-items: center;
  gap: 25px;
}
.stars i {
  color: #e6e6e6;
  font-size: 35px;
  cursor: pointer;
  transition: color 0.2s ease;
}
.stars i.active {
  color: #ff9c1a;
}

		.rating ul {
			list-style: none;
			margin: 0;
			padding: 0;
			display: flex;
		}

		.rating li {
			font-size: 24px;
			margin-right: 10px;
			cursor: pointer;
		}

			.rating li.active {
				color: #ffd700;
			}
	</style>
	<script>
		document.addEventListener("DOMContentLoaded", function (event) {
			const stars = document.querySelectorAll(".stars i");

			stars.forEach((star, index1) => {
				star.addEventListener("click", () => {
					stars.forEach((star, index2) => {
						index1 >= index2 ? star.classList.add("active") : star.classList.remove("active");
					});
				});
			});
		});
	</script>
</body>
